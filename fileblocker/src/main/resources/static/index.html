<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>파일 차단 확장자</title>
</head>
<body>
    <h2 class="section-title">◎ 파일 차단 확장자</h2>
    <p>파일확장자에 따라 특정 형식의 파일을 첨부하거나 전송하지 못하도록 제한</p>

    <!-- 고정 확장자 -->
    <div class="section row">
        <label class="form-label">고정 확장자</label>
        <div class="checkbox-group" id="fixed-extension-list">
        <label><input type="checkbox" value="bat"> bat</label>
        <label><input type="checkbox" value="cmd"> cmd</label>
        <label><input type="checkbox" value="com"> com</label>
        <label><input type="checkbox" value="cpl"> cpl</label>
        <label><input type="checkbox" value="exe"> exe</label>
        <label><input type="checkbox" value="scr"> scr</label>
        <label><input type="checkbox" value="js"> js</label>
        </div>
    </div>

    <!-- 커스텀 확장자 입력 -->
    <div class="section row">
        <label class="form-label">커스텀 확장자</label>
        <div class="custom-input">
            <input 
                type="text" 
                id="custom-extension-input" 
                class="input-field"
                placeholder="확장자 입력" 
                maxlength="20" 
            />
            <button id="add-extension-btn" class="add-button">+추가</button>
        </div>
    </div>

    <!-- 차단 목록 -->
    <div class="section row">
        <label class="form-label"></label>
        <div class="block-box">
            <p class="cnt-display"><span id="custom-count">3</span>/200</p>
            <div id="custom-extension-list" class="tag-list">
                <span class="tag">sh <button>×</button></span>
                <span class="tag">ju <button>×</button></span>
                <span class="tag">ch <button>×</button></span>
            </div>
        </div>
    </div>

    <script>
        // JS

        // 고정 확장자 체크박스 가져오기
        const fixedCheckboxes = document.querySelectorAll('#fixed-extension-list input[type="checkbox"]');

        // 체크박스마다 change 이벤트 감지해서 처리
        fixedCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                // 어떤 확장자인지 (value 속성으로 지정)
                const extension = e.target.value;

                // 체크 여부 true - 체크 false - 체크 해제
                const isChecked = e.target.checked;

                console.log(`확장자 ${extension} : ${isChecked ? 'true' : 'false'}`);

            });
        });

        // 태그 개수 업데이트 함수
        function updateCount(){
            const count = document.querySelectorAll('#custom-extension-list .tag').length;
            document.getElementById('custom-count').textContent = count;
        }

        // 사용자가 입력한 확장자를 태그로 만들어 리스트에 추가하는 함수
        function addExtensionTag(extension){
            const tagList = document.getElementById('custom-extension-list');

            // 현재 태그 개수
            const currentCount = tagList.children.length;

            // 최대 개수 설정
            if(currentCount >= 200){
                alert("최대 200개까지 추가할 수 있습니다.");
                return;
            }

            // 중복 태그 방지
            // 배열로 바꿔서 .some으로 하나라도 extension으로 시작하면 중복으로 판단
            const isDuplicate = Array.from(tagList.children).some(tag => {
                // 태그의 텍스트가 `${확장자} x` 형식
                return tag.textContent.trim().startsWith(extension + ' ');
            });

            // 아무것도 안 적으면 무시
            if(extension === '') return; 
            
            // 중복 입력
            if(isDuplicate){
                alert("이미 추가한 확장자입니다.");
                return;
            }

            // 중복이 아니라면 새로운 태그(span) 생성
            const span = document.createElement('span');
            span.className = 'tag';

            // span 안에 확장자 이름, 삭제버튼 넣기
            span.innerHTML = `${extension} <button class="remove-btn">x</button>`;

            // 태그 목록에 추가
            tagList.appendChild(span);

            updateCount();
        }

        // 추가 버튼 클릭시 실행할 함수
        document.getElementById('add-extension-btn').addEventListener('click', () => {
            // input 필드에서 입력한 값 가져오기
            const input = document.getElementById('custom-extension-input');
            const value = input.value.trim();

            addExtensionTag(value);

            // 태그 추가 후 입력창 비우기
            input.value='';
        });

        // 태그의 x를 눌렀을 때 해당 태그 삭제
        document.getElementById('custom-extension-list').addEventListener('click', (e) => {
            // 클릭한 대상이 <button>이면
            if(e.target.tagName === 'BUTTON'){
                // 부모 요소인 <span> 삭제
                e.target.parentElement.remove();

                updateCount();
            }
        });
    </script>
</body>
</html>
